# CS1237 GUI Application V3.0 - 使用指南

## ✅ 版本更新 (V3.0)

### 固件更新
- Arduino 固件已升级到 **V3.0**
- 采用新的数据帧格式：`[帧头(2B)] + [电压(4B float)] + [PGA(2B)] + [帧尾(2B)]`
- 固件直接发送**电压值**，无需GUI端计算转换

### GUI 适配
1. **数据显示**
   - Y轴从"ADC值"改为"电压 (mV)"
   - 实时显示格式：`📊 +1.2345 mV (PGA×128)`
   - 自动从数据帧中获取PGA增益值

2. **图表更新**
   - 主图标题：`实时电压波形`
   - 小图标题：`最近 20s` (显示电压 mV)
   - 分析窗口：`电压时域波形`

3. **数据导出**
   - TXT/CSV 文件表头已更新为"电压(mV)"
   - 文件头标注固件版本：`Firmware V3.0`
   - CSV列名：`time_s, voltage_mV`

## 环境配置

已成功配置 uv 环境，安装的依赖包：
- PyQt6 (6.10.0) - 图形界面
- pyserial (3.5) - 串口通信
- matplotlib (3.10.7) - 数据绘图

## 运行方式

### 方式1：使用 uv 运行（推荐）
```bash
uv run python 11.18gai.py
```

### 方式2：使用批处理文件
双击 `run.bat` 文件

### 方式3：激活虚拟环境后运行
```powershell
# PowerShell
.venv\Scripts\Activate.ps1
python 11.18gai.py

# CMD
.venv\Scripts\activate.bat
python 11.18gai.py
```

## 项目结构
```
.
├── pyproject.toml          # 项目配置文件
├── .venv/                  # 虚拟环境目录
├── src/cs1237_gui/         # Python包目录
├── 11.18gai.py            # 主程序 (V3.0)
├── run.bat                 # 启动脚本
└── 使用说明.md            # 本文件
```

## 功能特性

### 1. 实时采集
- 单次读取：读取一次电压值
- 连续读取：持续采集并绘图（按'S'停止）
- 自动时间轴：从0秒开始记录

### 2. 配置管理
- PGA增益：1/2/64/128 倍
- 采样率：10Hz/40Hz/640Hz/1280Hz
- 输入通道：通道A/保留/温度/内短
- Power down 模式控制

### 3. 数据分析
- 时域波形显示（主图 + 小图）
- 坐标轴范围调整
- 鼠标悬停显示坐标
- 矩形框缩放功能
- Y轴自动适配

### 4. 数据导出
- TXT格式：带完整文件头注释
- CSV格式：便于Excel/MATLAB导入
- 自动保存提醒

## 常用 uv 命令

- `uv sync` - 同步依赖
- `uv add <包名>` - 添加新依赖
- `uv remove <包名>` - 移除依赖
- `uv pip list` - 查看已安装的包
- `uv run <命令>` - 在虚拟环境中运行命令

## 串口通信协议

### 新帧格式 (V3.0)
```
[0xAA 0x55] + [电压float 4B] + [PGA uint16 2B] + [0x0D 0x0A]
总长度：10字节
字节序：小端序 (Little-Endian)
```

### 旧帧格式（配置/状态）
```
[0xAA 0x55] + [长度 1B] + [命令 1B] + [数据 nB] + [校验 1B] + [0x0D 0x0A]
```

## 注意事项

1. **Arduino 固件版本**：确保使用 V3.0 或更高版本
2. **波特率**：默认 115200（Arduino与GUI必须一致）
3. **供电电压**：Arduino代码中的`VDD`需与实际硬件一致（5V/3.3V）
4. **测温模式**：使用温度传感器通道时必须设置PGA=1

## 故障排除

### 串口连接失败
- 检查Arduino是否正确连接
- 确认COM口号是否正确
- 关闭其他占用串口的程序（如Arduino IDE串口监视器）

### 数据显示异常
- 确认Arduino固件为V3.0版本
- 检查PGA设置是否与硬件配置一致
- 重启Arduino后重新连接

### 虚拟环境问题
```bash
# 删除并重建虚拟环境
Remove-Item -Recurse -Force .venv
uv sync
```

## 更新日志

### V3.0 (2025-11-18)
- ✅ 适配Arduino固件V3.0电压帧格式
- ✅ 修复串口模块导入问题
- ✅ 更新所有图表和导出文件的单位标注
- ✅ 优化数据显示格式（mV显示，4位小数）
- ✅ 添加固件版本标识

### V2.x
- 支持ADC原始值采集
- 基本图形界面和数据分析功能
