==============================================================================
CS1237 GUI V3.0 更新说明 (2025-11-18)
==============================================================================

一、主要变更
-----------
1. 适配 Arduino 固件 V3.0 的新数据帧格式
   - 旧格式: [帧头] + [长度] + [命令] + [ADC原始值4字节] + [校验] + [帧尾]
   - 新格式: [帧头2B] + [电压float 4B] + [PGA uint16 2B] + [帧尾2B] = 10字节
   
2. GUI 直接显示电压值（mV）
   - 不再显示 ADC 原始码值
   - 自动从数据帧中获取 PGA 增益
   - 显示格式: 📊 +1.2345 mV (PGA×128)

3. 图表和导出更新
   - Y轴标签: "ADC值" → "电压 (mV)"
   - 导出文件标注单位为 mV
   - CSV 列名: voltage_mV


二、关键代码改动
---------------
1. SerialThread.parse_voltage_frame()
   - 解析 10 字节电压帧
   - 使用 struct.unpack('<f', ...) 解析小端序 float
   - 发送信号时命令码为 0xFF（区别于旧格式）

2. CS1237_GUI.handle_adc_frame()
   - 根据数据长度判断帧类型
   - len(data)==6: 新格式（电压4B + PGA2B）
   - len(data)==4: 旧格式（ADC原始值）
   - 统一转换为 mV 单位进行绘图

3. 图表标签更新
   - 主图: "实时电压波形"
   - 小图: "最近 20s" Y轴 "电压 (mV)"
   - 分析窗口: "电压时域波形"


三、使用方法
-----------
1. 上传 Arduino 固件 V3.0
   - 确保固件中 VDD 配置与硬件一致（5V/3.3V）
   
2. 启动 GUI
   - 运行: uv run python 11.18gai.py
   - 或双击: run.bat
   
3. 连接串口
   - 选择正确的 COM 口
   - 波特率: 115200
   - 点击"连接"按钮
   
4. 开始采集
   - 单次读取: 点击"单次读取"
   - 连续采集: 点击"开始连续读取"（按S停止）


四、数据帧示例
-------------
电压帧 (10字节):
  十六进制: AA 55 3F 9D F3 B6 80 00 0D 0A
  解析:
    帧头: AA 55
    电压: 3F 9D F3 B6 → 1.234 V (小端序 float)
    PGA:  80 00       → 128 (小端序 uint16)
    帧尾: 0D 0A
    
  GUI 显示: 📊 +1234.0000 mV (PGA×128)


五、兼容性说明
-------------
- ✅ 完全兼容 Arduino 固件 V3.0
- ✅ 向后兼容旧的配置帧格式（状态查询、设置等）
- ⚠️  不兼容旧固件的 ADC 数据帧（需升级固件）


六、测试检查清单
---------------
□ 串口能够正常连接
□ 单次读取显示电压值（mV）
□ 连续读取图形正常绘制
□ Y轴标签显示"电压 (mV)"
□ PGA 设置能够同步显示
□ 数据导出文件标注正确


七、常见问题
-----------
Q: 连接后无数据显示？
A: 检查Arduino固件版本是否为V3.0，旧固件不兼容。

Q: 显示的电压值不准确？
A: 确认Arduino代码中的VDD配置与实际供电电压一致。

Q: 导出的数据单位是什么？
A: 毫伏(mV)，CSV文件列名为 voltage_mV。


八、联系方式
-----------
如有问题，请检查:
1. Arduino 串口监视器的输出
2. GUI 数据输出区域的错误信息
3. 使用说明.md 文件


==============================================================================
版本: V3.0
更新日期: 2025-11-18
==============================================================================
